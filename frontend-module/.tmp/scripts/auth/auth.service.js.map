{"version":3,"sources":["../../../app/scripts/auth/auth.service.js"],"names":[],"mappings":";;AAEA,YAAY,CAAC;AACb,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CACzB,OAAO,CAAC,MAAM,EAAE,UAAS,UAAU,EAAE,MAAM,EAAE,EAAE,EAAE,UAAU,EAAE,QAAQ,EAAE,SAAS,EAAE,kBAAkB,EACjG,IAAI,EAAE;AACV,WAAO;AACH,aAAK,EAAE,eAAU,WAAW,EAAE,QAAQ,EAAE;AACpC,gBAAI,EAAE,GAAG,QAAQ,IAAI,OAAO,CAAC,IAAI,CAAC;AAClC,gBAAI,QAAQ,GAAG,EAAE,CAAC,KAAK,EAAE,CAAC;;AAE1B,8BAAkB,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU,IAAI,EAAE;;AAEvD,yBAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,YAAW;;;AAGrC,wBAAI,CAAC,GAAG,CAAC,oCAAoC,CAAC,CAAC;iBAClD,CAAC,CAAC;AACH,wBAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;AAEvB,uBAAO,EAAE,EAAE,CAAC;aACf,CAAC,SAAM,CAAC,CAAA,UAAU,GAAG,EAAE;AACpB,oBAAI,CAAC,MAAM,EAAE,CAAC;AACd,wBAAQ,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,CAAC;AAC7B,wBAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AACrB,uBAAO,EAAE,CAAC,GAAG,CAAC,CAAC;aAClB,CAAA,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;;AAEd,mBAAO,QAAQ,CAAC,OAAO,CAAC;SAC3B;;AAED,cAAM,EAAE,kBAAY;AAChB,8BAAkB,CAAC,MAAM,EAAE,CAAC;AAC5B,qBAAS,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;SAChC;;AAED,iBAAS,EAAE,mBAAS,KAAK,EAAE;AACvB,mBAAO,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,YAAW;AACzC,oBAAI,eAAe,GAAG,SAAS,CAAC,eAAe,EAAE,CAAC;AAClD,oBAAI,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,IAAI,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE;AACpI,wBAAI,eAAe,EAAE;;AAEjB,8BAAM,CAAC,EAAE,CAAC,cAAc,CAAC,CAAC;qBAC7B,MACI;;;AAGD,kCAAU,CAAC,aAAa,GAAG,UAAU,CAAC,OAAO,CAAC;AAC9C,kCAAU,CAAC,mBAAmB,GAAG,UAAU,CAAC,aAAa,CAAC;;;AAG1D,8BAAM,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;qBACtB;iBACJ;aACR,CAAC,CAAC;SACN;KACJ,CAAC;CACL,CAAC,CAAC","file":"auth.service.js","sourcesContent":["/* jshint -W097 */\n/* globals angular, $, Mentoring*/\n'use strict';\nangular.module('mentoringApp')\n    .factory('Auth', function($rootScope, $state, $q, $translate, Activate, Principal, AuthServerProvider, \n        $log) {\n    return {\n        login: function (credentials, callback) {\n            var cb = callback || angular.noop;\n            var deferred = $q.defer();\n\n            AuthServerProvider.login(credentials).then(function (data) {\n                // retrieve the logged account information\n                Principal.identity(true).then(function() {\n                    // After the login the language will be changed to\n                    // the language selected by the user during his registration\n                    $log.log('Usuario identificado correctamente');\n                });\n                deferred.resolve(data);\n\n                return cb();\n            }).catch(function (err) {\n                this.logout();\n                Activate.get({ key: \"KEY\" });\n                deferred.reject(err);\n                return cb(err);\n            }.bind(this));\n\n            return deferred.promise;\n        },\n\n        logout: function () {\n            AuthServerProvider.logout();\n            Principal.authenticate(null);\n        },\n\n        authorize: function(force) {\n            return Principal.identity(force).then(function() {\n                    var isAuthenticated = Principal.isAuthenticated();\n                    if ($rootScope.toState.data.roles && $rootScope.toState.data.roles.length > 0 && !Principal.isInAnyRole($rootScope.toState.data.roles)) {\n                        if (isAuthenticated) {\n                            // user is signed in but not authorized for desired state\n                            $state.go('accessdenied');\n                        }\n                        else {\n                            // user is not authenticated. stow the state they wanted before you\n                            // send them to the signin state, so you can return them when you're done\n                            $rootScope.returnToState = $rootScope.toState;\n                            $rootScope.returnToStateParams = $rootScope.toStateParams;\n\n                            // now, send them to the signin state so they can log in\n                            $state.go('login');\n                        }\n                    }\n            });\n        }\n    };\n});"]}