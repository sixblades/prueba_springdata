{"version":3,"sources":["../../../app/scripts/evaluation/leadersEvaluations.controller.js"],"names":[],"mappings":"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","file":"leadersEvaluations.controller.js","sourcesContent":["/* jshint -W097 */\n/* globals angular, $, Mentoring*/\n'use strict';\n/*@ngInject*/\nfunction LeadersEvaluationsController($rootScope, $state, $translate, \n        Principal, EmployeeLeaderResource, LeadersEvaluationsService) {\n    var vm = this;\n    \n    $rootScope.activeOption = 'consult';\n    \n    vm.onNgInit = () => {\n        if ($state.current.name != 'login') {\n            // Check if the user is authenticated before doing anything\n            Principal.identity().then(() => {\n                if(!Principal.isAuthenticated) {\n                    $state.go('login');\n                }\n                // Obtains all the leaders employees\n                EmployeeLeaderResource.query({}, (res) => {\n                    vm.leaders = res;\n                });\n                \n                vm.years = [];\n                let date = new Date();\n                let firstYear = 2015;\n                let thisYear = date.getFullYear();\n                while (firstYear<=thisYear) {\n                    vm.years.push(firstYear);\n                    firstYear++;\n                }\n            }, \n            // If not authenticated, forward to login page\n            (err) => {\n                $state.go('login');      \n            });\n        } \n    };\n    \n    // Handles the changes on the years combo\n    vm.changeYear = () => {\n        vm.changeEvaluator();\n    }\n    \n    // Handles the changes on the evaluator combo\n    vm.changeEvaluator = () => {\n        // If there is no year selected, force the selection of the current year\n        if(Mentoring.isUndefinedOrNull(vm.year)) {\n            let date = new Date();\n            vm.year = date.getFullYear();\n        }\n        // If there is leader selected...\n        if(!Mentoring.isUndefinedOrNull(vm.leader)) {\n            // Dispatch the server request\n            LeadersEvaluationsService.getLeadersEvaluations({leaderId: vm.leader.id, year: vm.year}, (res) => {\n                // if there are results\n                if(res.length > 0) {\n                    vm.showTable = true;\n                    // Iterate over all the result to do some process\n                    res.map( (r) => {\n                        let employee = r.employee;\n                        r.employee.name = employee.firstSurname + ' ' + employee.secondSurname + ', ' + employee.name;\n                        \n                        // Obtains the self evaluation label text and its class\n                        let selfEvalKey = 'leadersEvaluation.tabla.';\n                        if(r.selfEvaluation) {\n                            selfEvalKey += 'si';\n                            r.selfEvaluationClass = 'circle-green';\n                        } else {\n                            selfEvalKey += 'no';\n                            r.selfEvaluationClass = 'circle-red';\n                        }\n                        r.selfEvaluation = $translate.instant(selfEvalKey);\n                        \n                        // Same for final evaluation\n                        let finalEvalKey = 'leadersEvaluation.tabla.';\n                        if(r.finalEvaluation) {\n                            finalEvalKey += 'si';\n                            r.finalEvaluationClass = 'circle-green';\n                        } else {\n                            finalEvalKey += 'no';\n                            r.finalEvaluationClass = 'circle-red';\n                        }\n                        r.finalEvaluation = $translate.instant(finalEvalKey);\n                    });\n                    vm.leadersEvaluations = res;\n                } else {\n                    // If there are no results, don't show the table\n                    vm.showTable = false;\n                }\n            }, (err) => {\n                vm.Modal = {\n                    msg: 'leadersEvaluation.modal.error',\n                    title: 'leadersEvaluation.modal.error.title',\n                    button: 'leadersEvaluation.modal.ok',\n                    action: () => {\n                        $('#myModal').modal('hide');\n                    }\n                };\n                $('#myModal').modal('show');\n            });\n        } else {\n            vm.showTable = false;\n        }\n    }\n    \n    // Init the controller\n    vm.onNgInit();\n};\nangular.module('mentoringApp').controller('LeadersEvaluationsController', LeadersEvaluationsController);"]}