{"version":3,"sources":["../../../../app/scripts/account/login/login.controller.js"],"names":[],"mappings":";;;AAGA,YAAY,CAAC;;AAEb,SAAS,eAAe,CAAC,QAAQ,EAAE,MAAM,EAAE,IAAI,EAAE,QAAQ,EAAE,YAAY,EAAE;AACrE,QAAI,EAAE,GAAG,IAAI,CAAC;AACd,MAAE,CAAC,IAAI,GAAG,EAAE,CAAC;AACb,MAAE,CAAC,MAAM,GAAG,EAAE,CAAC;AACf,MAAE,CAAC,SAAS,GAAG,CAAC,MAAM,EAAE,aAAa,EAAE,UAAU,CAAC,CAAC;AACnD,MAAE,CAAC,OAAO,GAAG,EAAE,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;AAC7B,MAAE,CAAC,UAAU,GAAG,IAAI,CAAC;;;AAGrB,YAAQ,CAAC,GAAG,CAAC,EAAC,GAAG,EAAC,KAAK,EAAC,CAAC,CAAC;;;AAG1B,QAAI,YAAY,GAAG,QAAQ,CAAC,YAAY,CAAC;AACzC,QAAI,YAAY,KAAK,IAAI,IAAI,YAAY,KAAK,SAAS,EAAE;AACrD,UAAE,CAAC,OAAO,GAAG,YAAY,CAAC;KAC7B;;AAEF,MAAE,CAAC,KAAK,GAAG,YAAY;;AAElB,YAAI,EAAE,CAAC,QAAQ,KAAK,SAAS,IAAI,EAAE,CAAC,QAAQ,KAAK,SAAS,IAAI,EAAE,CAAC,OAAO,KAAK,SAAS,EAAE;AACpF,gBAAI,CAAC,KAAK,CAAC;AACP,wBAAQ,EAAE,EAAE,CAAC,QAAQ;AACrB,wBAAQ,EAAE,EAAE,CAAC,QAAQ;AACrB,uBAAO,EAAE,EAAE,CAAC,OAAO;aACtB,CAAC,CAAC,IAAI,CAAC,YAAM;AACV,kBAAE,CAAC,mBAAmB,GAAG,KAAK,CAAC;AAC/B,oBAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;AACrB,oBAAI,IAAI,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;AACzB,oBAAI,IAAI,EAAE,GAAC,EAAE,GAAC,EAAE,GAAC,IAAI,GAAC,IAAI,CAAC;AAC3B,mBAAG,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;AAClB,wBAAQ,CAAC,MAAM,GAAG,cAAc,GAAC,GAAG,GAAC,EAAE,CAAC,OAAO,GAAC,WAAW,GAAC,GAAG,CAAC,WAAW,EAAE,GAAC,SAAS,CAAC;AACxF,sBAAM,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;aACrB,CAAC,SAAM,CAAC,YAAM;AACX,kBAAE,CAAC,mBAAmB,GAAG,IAAI,CAAC;AAC9B,8BAAc,CAAC,qCAAqC,CAAC,CAAC;aACzD,CAAC,CAAC;SACN,MAAM;AACH,cAAE,CAAC,mBAAmB,GAAG,IAAI,CAAC;AAC9B,0BAAc,CAAC,2BAA2B,CAAC,CAAC;SAC/C;KACJ,CAAC;AACF,MAAE,CAAC,cAAc,GAAG,UAAU,KAAK,EAAE;AACjC,aAAK,CAAC,cAAc,GAAG,KAAK,CAAC,cAAc,EAAE,GAAG,KAAK,CAAC,WAAW,GAAG,KAAK,CAAC;KAC7E,CAAC;;AAEF,QAAI,cAAc,GAAG,SAAjB,cAAc,CAAI,GAAG,EAAK;AAC1B,UAAE,CAAC,KAAK,GAAG;AACP,eAAG,EAAH,GAAG;AACH,iBAAK,EAAE,4BAA4B;AACnC,kBAAM,EAAE,yBAAyB;AACjC,kBAAM,EAAE,kBAAM;AACV,iBAAC,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;aAC/B;SACJ,CAAC;;AAEF,SAAC,CAAC,UAAU,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;KAC/B,CAAA;CACJ;AACD,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,UAAU,CAAC,iBAAiB,EAAE,eAAe,CAAC,CAAC","file":"login.controller.js","sourcesContent":["/* jshint -W097 */\n/*jshint -W030 */\n/* globals angular, $, document */\n'use strict';\n/*@ngInject*/   \nfunction LoginController($cookies, $state, Auth, Activate, AuditService) {\n    var vm = this;\n    vm.user = {};\n    vm.errors = {};\n    vm.companies = ['VASS', 'VASSDigital', 'Serbatic'];\n    vm.company = vm.companies[0];\n    vm.rememberMe = true;\n    \n    /* Obtencion del token CRSF */\n    Activate.get({key:\"KEY\"});\n    \n    // Recuperamos el valor de la organizaciÃ³n de la cookie si existe\n    var organization = $cookies.organization;\n    if (organization !== null && organization !== undefined) {\n        vm.company = organization;\n    }\n    \n   vm.login = function () {\n        // Comprobamos si los valores de los campos requeridos son correctos\n        if (vm.username !== undefined && vm.password !== undefined && vm.company !== undefined) {\n            Auth.login({\n                username: vm.username,\n                password: vm.password,\n                company: vm.company\n            }).then(() => {\n                vm.authenticationError = false;\n                var now = new Date();\n                var time = now.getTime();\n                time += 24*60*60*1000*9999;\n                now.setTime(time);\n                document.cookie = 'organization'+'='+vm.company+';expires='+now.toGMTString()+';path=/';\n                $state.go('home');\n            }).catch(() => {\n                vm.authenticationError = true;\n                showLoginError('login.messages.error.authentication');\n            });\n        } else {\n            vm.authenticationError = true;\n            showLoginError('login.messages.error.form');\n        }\n    };\n    vm.cancelarEvento = function (event) {\n        event.preventDefault ? event.preventDefault() : event.returnValue = false;\n    };\n    \n    var showLoginError = (msg) => {\n        vm.Modal = {\n            msg,\n            title: 'login.messages.error.title',\n            button: 'login.messages.error.ok',\n            action: () => {\n                $('#myModal').modal('hide');\n            }\n        };\n        /* Now show the modal */\n        $('#myModal').modal('show');\n    }\n}\nangular.module('mentoringApp').controller('LoginController', LoginController);\n"]}