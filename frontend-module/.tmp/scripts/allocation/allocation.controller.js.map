{"version":3,"sources":["../../../app/scripts/allocation/allocation.controller.js"],"names":[],"mappings":"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","file":"allocation.controller.js","sourcesContent":["/* jshint -W097 */\r\n/* globals angular, $, Mentoring */\r\n'use strict';\r\n/*@ngInject*/\r\nfunction AllocationController($rootScope, $filter, $translate, EmployeeEvaluableIdResource,\r\n    EmployeeLeaderResource, Allocation, Allocations, AllocationsLeader, AllocationSave, AllocationsLE) {\r\n\r\n    var vm = this;\r\n\r\n    vm.onNgInit = () => {\r\n        // Activamos la opción de menú Consulta de Evaluación\r\n        $rootScope.activeOption = 'allocation';\r\n        \r\n        vm.empleado = {};\r\n        vm.leader = {};\r\n        vm.asignacion = [];\r\n        vm.fecha2 = null;\r\n\r\n        //Obtenemos empleados y mandos\r\n        EmployeeEvaluableIdResource.query((res) => {\r\n            vm.empleados = res;\r\n        });\r\n        EmployeeLeaderResource.query((res) => {\r\n            vm.leaders = res;\r\n        });\r\n    }\r\n\r\n    vm.change = () => {\r\n        let idEmployee = vm.empleado.id;\r\n        if (Mentoring.isUndefinedOrNull(vm.leader) || Mentoring.isUndefinedOrNull(vm.leader.id)) {\r\n            if (!Mentoring.isUndefinedOrNull(idEmployee)) {\r\n                Allocations.query({employeeId: idEmployee}, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n            } else {\r\n                vm.asignaciones = [];\r\n            }\r\n        } else {\r\n            if (Mentoring.isUndefinedOrNull(idEmployee)) {\r\n                AllocationsLeader.query({leaderId: vm.leader.id}, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n            }\r\n            else {\r\n                AllocationsLE.query({leaderId: vm.leader.id, employeeId: idEmployee }, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    vm.changeMando = () => {\r\n        // If no employee selected, check if there is leader selected also\r\n        if (Mentoring.isUndefinedOrNull(vm.empleado) || Mentoring.isUndefinedOrNull(vm.empleado.id)) {\r\n            if (!Mentoring.isUndefinedOrNull(vm.leader) && !Mentoring.isUndefinedOrNull(vm.leader.id)) {\r\n                AllocationsLeader.query({ leaderId: vm.leader.id }, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n            } else {\r\n                vm.asignaciones = [];\r\n            }\r\n        \r\n        // Else, if employee selected, check if there is leader selected to search for thier common allocations\r\n        } else {\r\n            if (!Mentoring.isUndefinedOrNull(vm.leader) && !Mentoring.isUndefinedOrNull(vm.leader.id)) {\r\n                AllocationsLE.query({ leaderId: vm.leader.id, employeeId: vm.empleado.id }, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n                // If no leader selected, search employee alocations only\r\n            } else {\r\n                Allocations.query({employeeId: vm.empleado.id }, (res) => {\r\n                    vm.asignaciones = res;\r\n                });\r\n            }\r\n        }\r\n    };\r\n\r\n    // Handles the click on New button\r\n    vm.showNewAllocation = () => {\r\n        vm.newAllocation = {};\r\n        $('form').removeClass('ng-sent');\r\n       \r\n        // If there is an employee selected, preselect it on the new dialog\r\n        if(vm.empleado) {\r\n            vm.newAllocation.employeeId = vm.empleado.id;\r\n        }\r\n        // Shows the new dialog\r\n        $('#myModalNew').modal('show');\r\n        let d = new Date();\r\n        vm.fecha = $filter('date')(d, $translate.instant('dateFormat'));\r\n        vm.today = new Date();\r\n    };\r\n    \r\n    // Saves an allocation\r\n    vm.saveAllocation = () => {\r\n        // First of all, check if the form is valid\r\n        if(Mentoring.isUndefinedOrNull(vm.newAllocation.employeeId) || Mentoring.isUndefinedOrNull(vm.newAllocation.leaderId) \r\n            || Mentoring.isUndefinedOrNull(vm.newAllocation.dateFrom)) {\r\n            showModal({msg:'allocation.modal.new.invalid', title: 'allocation.modal.new.warning'});\r\n            return;\r\n        }\r\n        AllocationSave.guardar(vm.newAllocation, () =>  {\r\n            $('#myModalNew').modal('hide');\r\n            showModal({msg:'allocation.modal.new.modify', title: 'allocation.modal.new.title'});\r\n            vm.change();\r\n        }, (err) => {\r\n            showModal({msg:err.data.msg});\r\n        });\r\n    };\r\n\r\n    // Handles the modification of an allocation\r\n    vm.modificar = () => {\r\n        // Creates the object to be sent to the server\r\n        let allocMod = vm.allocationToMod;\r\n        let dateFrom = $filter('date')(allocMod.dateFrom, 'dd/MM/yyyy');\r\n        let dateUntil = allocMod.dateUntil ? $filter('date')(allocMod.dateUntil, 'dd/MM/yyyy') : null;\r\n        let allocationToSave = {\r\n            id: allocMod.id,\r\n            employeeId: allocMod.employeeId,\r\n            leaderId: allocMod.leaderId,\r\n            dateFrom,\r\n            dateUntil\r\n        };\r\n        // Dispath server request\r\n        AllocationSave.update(allocationToSave, () => {\r\n            $('#myModalModify').modal('hide');\r\n            showModal({msg:'allocation.modal.success.modify', title: 'allocation.modal.success.title'});\r\n            vm.change();\r\n        }, (err) => { \r\n            let msg = 'allocation.modal.error.modify';\r\n            if (err.data && err.data.msg) {\r\n                msg = err.data.msg;\r\n            }\r\n            showModal({msg});\r\n        });\r\n    };\r\n\r\n    // Handles the click on the modify icon.\r\n    vm.obtenerId = (allocation) => {\r\n        // Flag to show or not the select date input\r\n        vm.showInputDate = false;\r\n        if (Mentoring.isUndefinedOrNull(allocation.dateUntil)) {\r\n           vm.showInputDate = true; \r\n        }\r\n        \r\n        // Gets a copy of the allocation to mod\r\n        vm.allocationToMod = angular.copy(allocation);\r\n        // Shows the modify dialog\r\n        $('#myModalModify').modal('show');\r\n    };\r\n\r\n    vm.cancelar = () => {\r\n        vm.fecha = null;\r\n    };\r\n    \r\n    var showModal = (opts) => {\r\n        vm.Modal = {\r\n            msg: opts.msg || 'allocation.modal.error.default',\r\n            title: opts.title || 'allocation.modal.error.title',\r\n            button: 'allocation.modal.ok',\r\n            action: opts.action || (() => {\r\n                $('#myModal').modal('hide');\r\n            })\r\n        };\r\n        $('#myModal').modal('show');\r\n    }\r\n}\r\nangular.module('mentoringApp').controller('AllocationController', AllocationController);\r\n"]}